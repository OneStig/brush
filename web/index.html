<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8" />
  <title>Brush Playground</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <nav class="bg-gray-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex-shrink-0">
          <a href="#" class="text-white font-bold text-xl">Brush</a>
        </div>
        <div class="hidden md:block">
          <div class="ml-10 flex items-baseline space-x-4">
            <a href="#" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Playground</a>
            <a href="API.html" class="text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium">API</a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="flex flex-col items-center justify-center min-h-screen bg-gray-100">
    <div class="container bg-white p-4 rounded-md flex items-center">
      <div class="editor flex gap-4">
        <div class="line-numbers">
          <span></span>
        </div>
        <textarea id="text" name="text" rows="40" class="w-full bg-gray-800 text-white rounded-md px-2 py-1" placeholder="Enter your code here"></textarea>
      </div>
      <div class="w-1/2">
        <img id="img" class="flex-shrink-0 p-2 rounded-md" src="placeholder.png"/>
      </div>
    </div>
    <br>
    <button onclick="window.processText()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Generate Image</button>
  </div>
  

  <script type="module" defer>
    import init, { process_file, greet } from "../pkg/brush.js";
    init().then(() => {
      console.log("Wasm module loaded");
    });

    function processText() {
      console.log("got to function");
      const text = document.getElementById("text").value;
      localStorage.setItem("textareaValue", text);
      console.log(text);
      const svgString = process_file(text); // call the Rust function to generate the SVG string
      console.log(svgString);
      const img = document.getElementById("img");
      img.src = "data:image/svg+xml;base64," + btoa(svgString); // convert the SVG string to a data URL
      // document.body.appendChild(img); // add the image to the HTML form
    }
    window.processText = processText
  </script>
  <script>
    const textarea = document.getElementById("text");
    const lineNumbers = document.querySelector(".line-numbers");

    const savedValue = localStorage.getItem("textareaValue");
    if (savedValue) {
      textarea.value = savedValue;
    }
    textarea.addEventListener("keydown", function (e) {
      if (e.key === "(") {
        const start = this.selectionStart;
        const end = this.selectionEnd;
        const value = this.value;
        this.value = value.substring(0, start) + "(" + value.substring(end);
        this.selectionStart = this.selectionEnd = start;
        this.value += ")";
        e.preventDefault();
      }
      const lines = textarea.value.split("\n").length;
      lineNumbers.innerHTML = "";
      for (let i = 1; i <= lines; i++) {
        lineNumbers.innerHTML += `<span></span>`;
      }
    });
    textarea.addEventListener("keydown", function (e) {
      if (e.key === "{") {
        const start = this.selectionStart;
        const end = this.selectionEnd;
        this.value = this.value.substring(0, start) + "{" + this.value.substring(end);
        this.selectionStart = this.selectionEnd = start + 1;
        this.value += "}";
        e.preventDefault();
      }
      const lines = textarea.value.split("\n").length;
      lineNumbers.innerHTML = "";
      for (let i = 1; i <= lines; i++) {
        lineNumbers.innerHTML += `<span></span>`;
      }
    });
    textarea.addEventListener("input", () => {
      const lines = textarea.value.split("\n").length;
      lineNumbers.innerHTML = "";
      for (let i = 1; i <= lines; i++) {
        lineNumbers.innerHTML += `<span></span>`;
      }
    });
    textarea.addEventListener("keydown", function (e) {
      if (e.key === "Tab") {
        e.preventDefault(); // prevent the default tab behavior
        const start = this.selectionStart;
        const end = this.selectionEnd;
        this.value = this.value.substring(0, start) + "\t" + this.value.substring(end);
        this.selectionStart = this.selectionEnd = start + 1;
      }
      const lines = textarea.value.split("\n").length;
      lineNumbers.innerHTML = "";
      for (let i = 1; i <= lines; i++) {
        lineNumbers.innerHTML += `<span></span>`;
      }
    });
  </script>
</body>

</html>